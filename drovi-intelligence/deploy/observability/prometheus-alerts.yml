groups:
  - name: drovi-intelligence
    rules:
      - alert: DroviHighErrorRate
        expr: |
          sum(rate(drovi_http_requests_total{status_code=~"5.."}[5m]))
          /
          sum(rate(drovi_http_requests_total[5m]))
          > 0.05
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "High 5xx error rate"
          description: "HTTP 5xx error rate > 5% for 10m"

      - alert: DroviHighLatencyP95
        expr: |
          histogram_quantile(
            0.95,
            sum(rate(drovi_http_request_duration_seconds_bucket[5m])) by (le)
          ) > 1
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High API latency (p95)"
          description: "p95 latency > 1s for 10m"

      - alert: DroviLLMErrorRate
        expr: |
          sum(rate(drovi_llm_requests_total{status="error"}[10m]))
          /
          sum(rate(drovi_llm_requests_total[10m]))
          > 0.05
        for: 15m
        labels:
          severity: warning
        annotations:
          summary: "High LLM error rate"
          description: "LLM error rate > 5% for 15m"

      - alert: DroviConnectorStale
        expr: |
          time() - drovi_connector_last_success_timestamp_seconds > 3600
        for: 30m
        labels:
          severity: warning
        annotations:
          summary: "Connector stale"
          description: "No successful connector sync for > 1h"

      - alert: DroviUemPersistSlow
        expr: |
          histogram_quantile(
            0.95,
            sum(rate(drovi_uem_persist_duration_seconds_bucket[5m])) by (le)
          ) > 0.5
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "UEM persist latency high"
          description: "p95 UEM persist > 500ms for 10m"
